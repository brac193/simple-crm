<% content_for :title, @car.display_name %>

<div class="row">
  <!-- Car Details -->
  <div class="col-md-6">
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
        <h1 class="card-title" style="margin: 0;"><%= @car.display_name %></h1>
        <span class="car-type-badge <%= @car.car_type %>">
          <%= @car.car_type.titleize %>
        </span>
      </div>
      
      <div class="car-card-image mb-6">
        <i class="fas fa-car" style="font-size: 4rem; color: #6c757d;"></i>
      </div>
      
      <div class="space-y-4">
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb;">
          <span style="color: #6b7280; font-weight: 500;">Make & Model</span>
          <span style="font-weight: 600;"><%= @car.make %> <%= @car.model %></span>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb;">
          <span style="color: #6b7280; font-weight: 500;">Year</span>
          <span style="font-weight: 600;"><%= @car.year %></span>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb;">
          <span style="color: #6b7280; font-weight: 500;">License Plate</span>
          <span style="font-weight: 600; font-family: monospace;"><%= @car.license_plate %></span>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb;">
          <span style="color: #6b7280; font-weight: 500;">Daily Rate</span>
          <span style="font-size: 1.5rem; font-weight: 700; color: #2563eb;"><%= number_to_currency(@car.daily_rate) %></span>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0;">
          <span style="color: #6b7280; font-weight: 500;">Car Type</span>
          <span style="font-weight: 600;"><%= @car.car_type.titleize %></span>
        </div>
      </div>
      
      <% if current_user&.admin? %>
        <div class="border-t pt-6 mt-6">
          <div class="flex gap-2">
            <%= link_to edit_car_path(@car), class: "btn btn-primary flex-1" do %>
              <i class="fas fa-edit" style="margin-right: 0.5rem;"></i>Edit Car
            <% end %>
            <%= link_to car_path(@car), 
                method: :delete, 
                data: { confirm: "Are you sure you want to delete this car?" },
                class: "btn btn-danger flex-1" do %>
              <i class="fas fa-trash" style="margin-right: 0.5rem;"></i>Delete Car
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Reservation Form -->
  <div class="col-md-6">
    <div class="card">
      <h2 class="card-title mb-6">Make a Reservation</h2>
      
      <%= form_with model: @reservation, local: true, class: "space-y-4" do |form| %>
        <%= form.hidden_field :car_id %>
        
        <div class="form-group">
          <%= form.label :start_date, "Start Date", class: "form-label" %>
          <%= form.date_field :start_date, 
              min: Date.current,
              class: "form-control",
              required: true %>
        </div>
        
        <div class="form-group">
          <%= form.label :end_date, "End Date", class: "form-label" %>
          <%= form.date_field :end_date, 
              min: Date.current + 1.day,
              class: "form-control",
              required: true %>
        </div>
        
        <div style="background-color: #f8f9fa; padding: 1rem; border-radius: 0.5rem;">
          <h3 style="font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Reservation Summary</h3>
          <div class="space-y-2" style="font-size: 0.875rem;">
            <div style="display: flex; justify-content: space-between;">
              <span>Daily Rate:</span>
              <span><%= number_to_currency(@car.daily_rate) %></span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Duration:</span>
              <span id="duration">-</span>
            </div>
            <div style="display: flex; justify-content: space-between; font-weight: 600; font-size: 1.125rem; border-top: 1px solid #e5e7eb; padding-top: 0.5rem;">
              <span>Total Price:</span>
              <span id="total-price">-</span>
            </div>
          </div>
        </div>
        
        <div class="flex gap-2">
          <%= form.submit "Book Reservation", class: "btn btn-primary flex-1" %>
          <%= link_to "Back to Cars", cars_path, class: "btn btn-secondary flex-1 text-center" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const startDateInput = document.getElementById('reservation_start_date');
  const endDateInput = document.getElementById('reservation_end_date');
  const durationSpan = document.getElementById('duration');
  const totalPriceSpan = document.getElementById('total-price');
  const dailyRate = <%= @car.daily_rate %>;
  
  function updateSummary() {
    const startDate = new Date(startDateInput.value);
    const endDate = new Date(endDateInput.value);
    
    if (startDate && endDate && endDate > startDate) {
      const diffTime = Math.abs(endDate - startDate);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      const totalPrice = diffDays * dailyRate;
      
      durationSpan.textContent = `${diffDays} day${diffDays > 1 ? 's' : ''}`;
      totalPriceSpan.textContent = `$${totalPrice.toFixed(2)}`;
    } else {
      durationSpan.textContent = '-';
      totalPriceSpan.textContent = '-';
    }
  }
  
  startDateInput.addEventListener('change', updateSummary);
  endDateInput.addEventListener('change', updateSummary);
});
</script>
